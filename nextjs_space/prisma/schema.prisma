generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/clivus_landing_page/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Lead {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  cnpj         String?
  businessArea String?
  source       String?  @default("landing_page")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("leads")
}

// NextAuth Models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id            String        @id @default(cuid())
  name          String
  email         String        @unique
  password      String
  cpf           String?
  cnpj          String?
  businessArea  String?
  emailVerified DateTime?
  image         String?
  role          String        @default("user") // user, admin, superadmin
  hasAccess     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  accounts      Account[]
  sessions      Session[]
  transactions  Transaction[]
  payments      Payment[]

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Financial Models
model Transaction {
  id          String       @id @default(cuid())
  userId      String
  type        String // income, expense
  category    String
  description String
  amount      Float
  date        DateTime
  accountType String // CPF, CNPJ
  attachments Attachment[]
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([accountType])
  @@index([date])
  @@map("transactions")
}

model Attachment {
  id            String      @id @default(cuid())
  transactionId String
  fileName      String
  fileUrl       String
  fileType      String
  fileSize      Int
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  createdAt     DateTime    @default(now())

  @@index([transactionId])
  @@map("attachments")
}

// Payment Models
model Payment {
  id              String   @id @default(cuid())
  userId          String
  planId          String?
  stripeSessionId String?  @unique
  stripePaymentId String?
  amount          Float
  currency        String   @default("brl")
  status          String // pending, completed, failed
  plan            String   @default("lifetime_97") // lifetime_97, basic, intermediate, advanced (slug)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  planDetails     Plan?    @relation(fields: [planId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([status])
  @@index([planId])
  @@map("payments")
}

// Plans Model
model Plan {
  id          String    @id @default(cuid())
  name        String   // Básico, Intermediário, Avançado
  slug        String   @unique // basic, intermediate, advanced
  price       Float    // 97, 147, 297
  currency    String   @default("brl")
  isActive    Boolean  @default(true)
  features    String[] // Array de funcionalidades
  order       Int      @default(0) // Ordem de exibição
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  payments    Payment[]

  @@map("plans")
}
